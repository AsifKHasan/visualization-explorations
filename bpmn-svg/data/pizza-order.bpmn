/*
1. to parse the bpmn only, run
    python bpmn-parser.py < ../data/pizza-order.bpmn > ../out/pizza-order.json
    it will generate json output at ../out/pizza-order.json

2. to parse the bpmn and generate the svg, run
    python bpmn-parser.py < ../data/pizza-order.bpmn | tee ../out/pizza-order.json | python bpmn-to-svg.py
    it will generate svg output at ../out/pizza-order.svg

3. to generate svg from an existing parsed json (generated by bpmn-parser.py), run
    python bpmn-to-svg.py < ../out/pizza-order.json
    it will generate svg output at ../out/pizza-order.svg
*/
graph pizza_order {
    label = "Pizza Order Process Model"

    lane customer {
        label = "Customer"
        pool pizza_customer {
            label = "Pizza Customer"

            start               hungry                  [label="Hungry";]
            task                select_pizza            [label="Select Pizza";]
            task                order_pizza             [label="Order Pizza";]
            eventBased          on_order                [label="";]
            throwMessage        pizza_received          [label="Pizza Received";]
            #task                check_pizza             [label="Check Pizza";]

            timer               timer_4m_mins           [label="45 Minutes";]
            task                ask_for_pizza           [label="Ask for Pizza";]

            task                eat_pizza               [label="Eat Pizza";]
            task                pay_for_pizza           [label="Pay for Pizza";]
            end                 hunger_satisfied        [label="Hunger Satisfied";]

            hungry              --> select_pizza        --> order_pizza         --> on_order
            pizza_received      --> check_pizza
            on_order            --> pizza_received      --> pay_for_pizza       --> eat_pizza           --> hunger_satisfied
            on_order            --> timer_4m_mins       --> ask_for_pizza       --> event_based
            pay_for_pizza       ~~> on_order
        }

        # edges within pools of customer
        # edges from customer:pizza_customer
    }
    lane pizza_store {
        label = "Pizza Store"
        pool receptionist {
            label = "Receptionist"

            startMessage        order_received          [label="Order Received";]
            parallel            on_order_received       [label="";]
            throwMessage        where_is_pizza          [label="Where is Pizza?";]
            task                deal_with_customer      [label="Deal with Customer";]

            order_received      --> on_order_received
            on_order_received   --> where_is_pizza      --> deal_with_customer
            deal_with_customer  --> where_is_pizza
        }
        pool cook {
            label = "Pizza Cook"

            task                bake_pizza              [label="Bake Pizza";]
        }
        pool delivery_person {
            label = "Delivery Person"

            task                deliver_pizza           [label="Deliver Pizza";]
            task                collect_payment         [label="Collect Payment";]
            endTerminate        end_terminate           [label="";]

            deliver_pizza       --> collect_payment     --> end_terminate
        }

        # edges within pools of pizza_store
        # edges from pizza_store:receptionist
        on_order_received       --> bake_pizza

        # edges from pizza_store:cook
        bake_pizza              --> deliver_pizza

        # edges from pizza_store:delivery_person
    }

    # edges across lanes
    # edges from customer:pizza_customer
    order_pizza             ~~> order_received          [label="pizza order"]
    ask_for_pizza           ~~> where_is_pizza
    pay_for_pizza           ~~> collect_payment         [label="money"]

    # edges from pizza_store:receptionist
    deal_with_customer      ~~> ask_for_pizza

    # edges from pizza_store:cook

    # edges from pizza_store:delivery_person
    deliver_pizza           ~~> pizza_received          [label="pizza"]
    collect_payment         ~~> pay_for_pizza           [label="receipt"]
}
